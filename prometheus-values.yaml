# https://github.com/rancher/rancher/issues/28942
coreDns:
  enabled: false
kubeDns:
  enabled: true

global:
  rbac:
    create: true

alertmanager:
  enabled: true
  config:
    global:
      resolve_timeout: 5m
    route:
      group_by: ['alertname']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 1h
      receiver: 'slack'
      routes:
        - match:
            alertname: Watchdog
          receiver: 'null'
    receivers:
      - name: 'slack'
        slack_configs:
          - send_resolved: true
            api_url: 'https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX'
            channel: '#notifications'
            text: >-
              {{ range .Alerts }}
              *Alert:* {{ .Annotations.summary }}
              *Description:* {{ .Annotations.description }}
              *Severity:* {{ .Labels.severity }}
              *Time:* {{ .StartsAt }}
              {{ end }}
      - name: 'null'
    templates: []

prometheus:
  enabled: true
  crds:
    create: true
  prometheusSpec:
    ruleSelector:
      matchLabels:
        role: prometheus-rulefiles
    ruleNamespaceSelector:
      matchNames:
      - monitoring
    additionalScrapeConfigs:
      name: prometheus-additional-scrape-configs
      key: additional-scrape-configs.yaml
    volumes:
      - name: prometheus-custom-rules
        configMap:
          name: prometheus-custom-rules
    volumeMounts:
      - name: prometheus-custom-rules
        mountPath: /etc/prometheus/rules
  prometheusRules:
    additionalPrometheusRules:
      - name: custom-rules
        groups:
          - name: example.rules
            rules:
              - alert: PodFailure
                expr: kube_pod_status_phase{phase="Failed"} > 0
                for: 1m
                labels:
                  severity: critical
                annotations:
                  summary: "Pod failed to start"
                  description: "Pod {{ $labels.namespace }}/{{ $labels.pod }} has failed to start."
              - alert: WebsiteDown
                expr: probe_success{job="blackbox"} == 0
                for: 1m
                labels:
                  severity: critical
                annotations:
                  summary: "Public website is down"
                  description: "The public website is down."

grafana:
  enabled: true
  admin:
    existingSecret: grafana-admin-secret
  sidecar:
    dashboards:
      enabled: true
    datasources:
      enabled: true

kubeStateMetrics:
  enabled: true

nodeExporter:
  enabled: true

blackboxExporter:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/blackbox-exporter
    tag: 0.25.0-debian-12-r4
    pullPolicy: IfNotPresent
  configuration: |
    "modules":
      "http_2xx":
        "http":
          "preferred_ip_protocol": "ip4"
        "prober": "http"
      "http_post_2xx":
        "http":
          "method": "POST"
          "preferred_ip_protocol": "ip4"
        "prober": "http"
      "irc_banner":
        "prober": "tcp"
        "tcp":
          "preferred_ip_protocol": "ip4"
          "query_response":
          - "send": "NICK prober"
          - "send": "USER prober prober prober :prober"
          - "expect": "PING :([^ ]+)"
            "send": "PONG ${1}"
          - "expect": "^:[^ ]+ 001"
      "pop3s_banner":
        "prober": "tcp"
        "tcp":
          "preferred_ip_protocol": "ip4"
          "query_response":
          - "expect": "^+OK"
          "tls": true
          "tls_config":
            "insecure_skip_verify": false
      "ssh_banner":
        "prober": "tcp"
        "tcp":
          "preferred_ip_protocol": "ip4"
          "query_response":
          - "expect": "^SSH-2.0-"
      "tcp_connect":
        "prober": "tcp"
        "tcp":
          "preferred_ip_protocol": "ip4"

prometheusOperator:
  enabled: true
  createCustomResource: true
  prometheusConfigReloaderImage:
    repository: bitnami/prometheus-operator
    tag: 0.73.2-debian-12-r0